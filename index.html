<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Drum Step Editor</title>
  <style>
    body {
      font-family: monospace;
      background: #111;
      color: #eee;
      padding: 20px;
    }

    .container {
      display: flex;
      align-items: flex-start;
    }

    .labels {
      display: flex;
      flex-direction: column;
      margin-right: 12px;
    }

    .label {
      line-height: 40px;
      height: 40px;
      padding-right: 8px;
      text-align: right;
      font-size: 18px;
      font-weight: bold;
      color: #888;
    }

    .grid {
      display: grid;
      border: 2px solid #333;
      border-right: none;
      border-bottom: none;
    }

    .cell {
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      box-sizing: border-box;
      border-right: 2px solid #333;
      border-bottom: 2px solid #333;
      transition: background 0.1s ease-out;
    }

    button,
    input[type="number"] {
      background: #222;
      color: #eee;
      border: 1px solid #555;
      border-radius: 4px;
      padding: 6px 10px;
      margin-top: 10px;
    }

    button:hover {
      background: #333;
      cursor: pointer;
    }

    #configForm label {
      display: block;
      margin-top: 6px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="labels" class="labels"></div>
    <div id="grid" class="grid"></div>
  </div>

  <button id="exportBtn">Export Image</button>

  <form id="configForm">
    <label>Steps <input type="number" id="stepsInput" value="8" min="1"></label>
    <label>Group <input type="number" id="shadeInput" value="2" min="1"></label>

    <label><input type="checkbox" name="row" value="CY" checked> CY</label>
    <label><input type="checkbox" name="row" value="HT" checked> HT</label>
    <label><input type="checkbox" name="row" value="MT" checked> MT</label>
    <label><input type="checkbox" name="row" value="LT" checked> LT</label>
    <label><input type="checkbox" name="row" value="SD" checked> SD</label>
    <label><input type="checkbox" name="row" value="BD" checked> BD</label>

    <button type="submit">Apply</button>
  </form>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script>
    const CONFIG = {
      steps: 8,
      shadeGroup: 2,
      w: 40,
      h: 40,
      colors: {
        border: "#333",
        empty: "#888",
        shadeA: "#1b1b1b",
        shadeB: "#111",
        cursor: "#063"
      }
    };

    const ALL_ROWS = [
      { id: "CY", label: "CY", hit: "×", color: "#00AA22" },
      { id: "HT", label: "HT", hit: "●", color: "#DD9900" },
      { id: "MT", label: "MT", hit: "●", color: "#DD9900" },
      { id: "LT", label: "LT", hit: "●", color: "#DD9900" },
      { id: "SD", label: "SD", hit: "●", color: "#0066FF" },
      { id: "BD", label: "BD", hit: "●", color: "#CC0000" }
    ];

    const ALT = { 1: "●", 2: "×", 3: "○", 4: "✶", 5: "◇", 6: "+" };

    let ROWS = [...ALL_ROWS];
    let grid = [];
    let cursor = { r: 0, c: 0 };

    const labelsEl = document.getElementById("labels");
    const gridEl = document.getElementById("grid");

    function initGrid() {
      grid = Array.from({ length: ROWS.length }, () => Array(CONFIG.steps).fill(""));
    }

    function renderLabels() {
      labelsEl.innerHTML = ROWS.map(r => `<div class="label">${r.label}</div>`).join("");
    }

    function renderGrid() {
      gridEl.innerHTML = "";
      gridEl.style.gridTemplateColumns = `repeat(${CONFIG.steps}, ${CONFIG.w}px)`;
      gridEl.style.gridTemplateRows = `repeat(${ROWS.length}, ${CONFIG.h}px)`;

      ROWS.forEach((_, r) => {
        for (let c = 0; c < CONFIG.steps; c++) {
          const cell = document.createElement("div");
          cell.className = "cell";
          cell.style.width = CONFIG.w + "px";
          cell.style.height = CONFIG.h + "px";

          const shaded = Math.floor(c / CONFIG.shadeGroup) % 2 === 0;

          cell.style.background = shaded ? CONFIG.colors.shadeA : CONFIG.colors.shadeB;
          if (cursor.r === r && cursor.c === c) cell.style.background = CONFIG.colors.cursor;

          const sym = grid[r][c];
          cell.textContent = sym;
          cell.style.color = sym ? ROWS[r].color : CONFIG.colors.empty;

          gridEl.appendChild(cell);
        }
      });
    }

    function render() {
      renderLabels();
      renderGrid();
    }

    function toggle(symbol = null) {
      const row = ROWS[cursor.r];
      const sym = symbol || row.hit;
      grid[cursor.r][cursor.c] = grid[cursor.r][cursor.c] === sym ? "" : sym;
      render();
    }

    document.addEventListener("keydown", e => {
      const k = e.key;
      if ([" ", "ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].includes(k)) e.preventDefault();

      const moves = {
        ArrowUp: () => cursor.r = Math.max(0, cursor.r - 1),
        ArrowDown: () => cursor.r = Math.min(ROWS.length - 1, cursor.r + 1),
        ArrowLeft: () => cursor.c = Math.max(0, cursor.c - 1),
        ArrowRight: () => cursor.c = Math.min(CONFIG.steps - 1, cursor.c + 1),
        " ": () => toggle()
      };

      if (moves[k]) moves[k]();
      else if (ALT[k]) toggle(ALT[k]);
      else return;

      render();
    });

    document.getElementById("configForm").addEventListener("submit", e => {
      e.preventDefault();

      CONFIG.steps = Math.max(1, parseInt(stepsInput.value));
      CONFIG.shadeGroup = Math.max(1, parseInt(shadeInput.value));

      const rows = [...document.querySelectorAll("input[name='row']")]
        .filter(x => x.checked)
        .map(x => x.value);

      ROWS = ALL_ROWS.filter(r => rows.includes(r.id));

      cursor = { r: 0, c: 0 };
      initGrid();
      render();
    });

    document.getElementById("exportBtn").addEventListener("click", () => {
      const node = document.querySelector(".container");
      html2canvas(node, { scale: 4 }).then(canvas => {
        const link = document.createElement("a");
        link.href = canvas.toDataURL();
        link.download = `drum-${Date.now()}.png`;
        link.click();
      });
    });

    initGrid();
    render();
  </script>
</body>
</html>
